[dotenv@17.2.4] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops
[Prisma] Γ£à Loaded 7 environment variables from D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\apps\api\.env
[Prisma] Using DATABASE_URL: Γ£à Set
[AI Config] Using embeddings provider: ollama
============================================================
TESTING KNOWLEDGE SERVICE DIRECTLY
============================================================

1. Calling addKnowledge with:
   - tenantId: test-tenant-123
   - content: This is test content
   - source: manual


============================================================
[KnowledgeService] Adding knowledge for tenant test-tenant-123
[KnowledgeService] Content length: 48 chars
[KnowledgeService] Split into 1 chunks
[Chunk 1/1] Processing (48 chars)...
prisma:error 
Invalid `prisma.knowledgeChunk.create()` invocation in
D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\apps\api\src\services\KnowledgeService.ts:73:61

  70 const vector = await embeddings.embedQuery(chunkText);
  71 
  72 // 2. Save to Postgres
ΓåÆ 73 const dbChunk = await prisma.knowledgeChunk.create(
Foreign key constraint violated: `KnowledgeChunk_tenantId_fkey (index)`

============================================================
Γ¥î ERROR CAUGHT - THIS IS THE EXACT PROBLEM:
============================================================

Error Name: PrismaClientKnownRequestError

Error Message: 
Invalid `prisma.knowledgeChunk.create()` invocation in
D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\apps\api\src\services\KnowledgeService.ts:73:61

  70 const vector = await embeddings.embedQuery(chunkText);
  71 
  72 // 2. Save to Postgres
ΓåÆ 73 const dbChunk = await prisma.knowledgeChunk.create(
Foreign key constraint violated: `KnowledgeChunk_tenantId_fkey (index)`

Error Code: P2003

Full Stack Trace:
PrismaClientKnownRequestError: 
Invalid `prisma.knowledgeChunk.create()` invocation in
D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\apps\api\src\services\KnowledgeService.ts:73:61

  70 const vector = await embeddings.embedQuery(chunkText);
  71 
  72 // 2. Save to Postgres
ΓåÆ 73 const dbChunk = await prisma.knowledgeChunk.create(
Foreign key constraint violated: `KnowledgeChunk_tenantId_fkey (index)`
    at $n.handleRequestError (D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\node_modules\@prisma\client\runtime\library.js:121:7315)
    at $n.handleAndLogRequestError (D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\node_modules\@prisma\client\runtime\library.js:121:6623)
    at $n.request (D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\node_modules\@prisma\client\runtime\library.js:121:6307)
    at async l (D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\node_modules\@prisma\client\runtime\library.js:130:9633)
    at async KnowledgeService.addKnowledge (D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\apps\api\src\services\KnowledgeService.ts:73:33)
    at async testDirectly (D:\MobileApp\Chatbot\chatbot-master\chatbot-saas\apps\api\test_exact_error.ts:14:24)

============================================================
